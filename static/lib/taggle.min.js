/*!
* @author Sean Coker <sean@seancoker.com>
* @version 1.3.0
* @url http://sean.is/poppin/tags
* @license MIT
* @description Taggle is a dependency-less tagging library
*/
(function(e,t){function n(){if(!(2>arguments.length)){for(var e=arguments[0],t=1,n=arguments.length;n>t;t++){var a=arguments[t];for(var l in a)a.hasOwnProperty(l)&&(e[l]=a[l])}return e}}function a(e){return Array.isArray?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)}function l(e,t){var n="a"===e.tagName.toLowerCase()?e.parentNode:e,a=t.elements.indexOf(n);t.elements.splice(a,1),t.values.splice(a,1)}function s(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n}function i(e){return e.replace(/^\s+|\s+$/g,"")}function r(t,n){e.attachEvent&&!e.addEventListener?t.innerText=n:t.textContent=n}var o={additionalTagClasses:"",allowDuplicates:!1,duplicateTagClass:"",containerFocusClass:"active",hiddenInputName:"taggles[]",tags:[],tabIndex:1,placeholder:"Enter tags...",onTagAdd:function(){},onTagRemove:function(){}},c=8,u=188,d=9,g=13,p=function(p,f){function v(){h(),m(),y()}function h(){var t,n,a;z.container.rect=D.getBoundingClientRect(),z.container.style=e.getComputedStyle(D),t=z.container.style,n=parseInt(t["padding-left"]||t.paddingLeft,10),a=parseInt(t["padding-right"]||t.paddingRight,10),z.container.padding=n+a}function m(){var t;if(j.className="taggle_list",H.type="text",H.className="taggle_input",H.tabIndex=F.tabIndex,M.className="taggle_sizer",F.tags.length)for(var n=0,a=F.tags.length;a>n;n++){var l=k(F.tags[n]);j.appendChild(l)}q&&(q.style.opacity=0,q.classList.add("taggle_placeholder"),D.appendChild(q),r(q,F.placeholder),F.tags.length||(q.style.opacity=1)),V.appendChild(H),j.appendChild(V),D.appendChild(j),D.appendChild(M),t=e.getComputedStyle(H)["font-size"],M.style.fontSize=t}function y(){s(D,"click",function(){H.focus()}),H.onfocus=N,H.onblur=I,s(H,"keydown",_),s(H,"keyup",b)}function C(){var e,t,n,a,l;T(),t=H.getBoundingClientRect(),n=z.container.rect,e=~~n.width,e||(e=~~n.right-~~n.left),a=~~t.left-~~n.left,l=z.container.padding,T(e-a-l)}function L(e,t){var n,a,l,s="string"==typeof t?t.toLowerCase():i(H.value.toLowerCase());!F.allowDuplicates&&E()||""===s||(n=k(s),a=j.querySelectorAll("li"),l=a[a.length-1],j.insertBefore(n,l),F.onTagAdd(e,s),H.value="",T(),C(),N())}function w(t){t=t||e.event;var n=D.querySelectorAll(".taggle"),a=n[n.length-1],l="taggle_hot",s=H.classList.contains("taggle_back");""!==H.value||t.keyCode!==c||s?a.classList.contains(l)&&a.classList.remove(l):a.classList.contains(l)?(H.classList.add("taggle_back"),R(a,t),C(),N()):a.classList.add(l)}function T(e){H.style.width=(e||10)+"px"}function E(e){var t,n=H.value,a=e?e.toLowerCase():i(n.toLowerCase()),l=O.values.indexOf(a),s=D.querySelector(".taggle_list");if(F.duplicateTagClass){t=s.querySelectorAll("."+F.duplicateTagClass);for(var r=0,o=t.length;o>r;r++)t[r].classList.remove(F.duplicateTagClass)}return l>-1?(F.duplicateTagClass&&s.childNodes[l].classList.add(F.duplicateTagClass),!0):!1}function x(e){var t=!1;return(e===u||e===d||e===g)&&(t=!0),t}function N(){C(),D.classList.contains(F.containerFocusClass)||D.classList.add(F.containerFocusClass),q&&(q.style.opacity=0)}function I(){H.value="",T(),D.classList.contains(F.containerFocusClass)&&D.classList.remove(F.containerFocusClass),!O.values.length&&q&&(q.style.opacity=1)}function _(t){t=t||e.event;var n=t.keyCode;return S(),x(n)&&""!==H.value?(A(t),undefined):(O.values.length&&w(t),undefined)}function b(t){t=t||e.event,H.classList.remove("taggle_back"),r(M,H.value)}function A(t){t=t||e.event,L(t),t.preventDefault?t.preventDefault():t.returnValue=!1}function S(){var e=M.getBoundingClientRect().width,t=z.container.rect.width-z.container.padding,n=parseInt(M.style.fontSize,10);e+1.5*n>parseInt(H.style.width,10)&&(H.style.width=t+"px")}function k(e){var n=t.createElement("li"),a=t.createElement("a"),l=t.createElement("input"),s=t.createElement("span");return e=e.toLowerCase(),a.href="javascript:void(0)",a.innerHTML="&times;",a.className="close",a.onclick=R.bind(null,a),r(s,e),s.className="taggle_text",n.className="taggle "+F.additionalTagClasses,l.type="hidden",l.value=e,l.name=F.hiddenInputName,n.appendChild(s),n.appendChild(a),n.appendChild(l),O.values.push(e),O.elements.push(n),n}function R(e,t){var n,a;"li"!==e.tagName.toLowerCase()&&(e=e.parentNode),n=e.querySelector(".taggle_text"),a=n.innerText||n.textContent,F.onTagRemove(t,a),e.parentNode.removeChild(e),l(e,O),N()}var q,B=this,F=n({},o,f),z={container:{rect:null,style:null,padding:null}},D=p,O={values:[],elements:[]},j=t.createElement("ul"),V=t.createElement("li"),H=t.createElement("input"),M=t.createElement("div");F.placeholder&&(q=t.createElement("span")),"string"==typeof p&&(D=t.getElementById(p)),B.getTags=function(){return O},B.getTagElements=function(){return O.elements},B.getTagValues=function(){return O.values},B.getInput=function(){return H},B.getContainer=function(){return D},B.add=function(e){var t=a(e);if("string"==typeof e)return L(null,e);if(t)for(var n=0,l=e.length;l>n;n++)"string"==typeof e[n]&&L(null,e[n]);return B},B.remove=function(e,t){for(var n=O.values.length-1,a=!1;n>-1&&(O.values[n]===e&&(a=!0,R(O.elements[n])),!a||t);)n--;return B},v()};e.Taggle=p})(window,document);